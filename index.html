<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CellSolution</title>

<style>
body{margin:0;font-family:Arial, Helvetica, sans-serif;background:#1c1933;}
header{background:#861e1e;color:white;padding:20px;text-align:center;position:relative;}
.cart-icon{position:absolute;right:20px;top:15px;font-size:28px;cursor:pointer;}
.cart-count{position:absolute;top:-8px;right:-10px;background:red;color:white;font-size:14px;border-radius:50%;padding:3px 7px;}
.search-bar{text-align:center;padding:15px;}
.search-bar input{width:60%;padding:10px;font-size:16px;border-radius:6px;border:1px solid #ccc;}
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;padding:20px;}
.product{background:rgb(19, 138, 218);border-radius:10px;padding:15px;text-align:center;box-shadow:0 3px 8px rgba(0,0,0,0.1);cursor:pointer;transition:0.2s;}
.product:hover{transform:scale(1.03);}
.product img{width:100%;height:160px;object-fit:cover;border-radius:8px;}
.product h3{margin:10px 0 5px;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;}
.modal-content{background:white;padding:20px;width:350px;border-radius:10px;}
.modal-content img{width:100%;border-radius:8px;}
.modal-thumbnails{display: flex; gap: 10px; margin-top: 10px; justify-content: center;}
.modal-thumbnails img{width:50px; height:50px; object-fit:cover; border-radius:8px; cursor:pointer;}
.btn{padding:8px 12px;border:none;border-radius:6px;cursor:pointer;margin-top:8px;}
.btn-primary{background:#10b981;color:white;}
.btn-close{background:#ef4444;color:white;}
.cart-panel{position:fixed;top:0;right:-350px;width:300px;height:100%;background:white;transition:0.3s;padding:20px;overflow:auto;box-shadow:-3px 0 10px rgba(0,0,0,0.2);}
.cart-panel.active{right:0;}
.cart-item{border-bottom:1px solid #ddd;padding:8px 0;}
.back-btn{margin-bottom:10px;padding:6px 10px;background:#374151;color:white;border:none;border-radius:6px;cursor:pointer;}
.order-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;}
.order-modal-content{background:white;padding:20px;width:350px;border-radius:10px;}
</style>
</head>
<body>

<header>
    CellSolution
    <div class="cart-icon" onclick="toggleCart()">üõí<span id="cart-count" class="cart-count">0</span></div>
</header>

<div class="search-bar">
    <input type="text" id="searchInput" placeholder="Buscar producto..." onkeyup="searchProducts()">
</div>

<div id="product-list" class="products"></div>

<!-- MODAL PRODUCTO -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle"></h3>
        <img id="modalImg">
        <p id="modalDesc"></p>
        <p><strong>$<span id="modalPrice"></span></strong></p>
        <div id="modalThumbnails" class="modal-thumbnails"></div>
        <button class="btn btn-primary" onclick="addToCartFromModal()">Agregar al carrito</button>
        <button class="btn btn-close" onclick="closeModal()">Cerrar</button>
    </div>
</div>

<!-- CARRITO -->
<div id="cart-panel" class="cart-panel">
    <h2>Tu Pedido</h2>
    <div id="cart-items"></div>
    <h3>Total: $<span id="total">0</span></h3>
    <button class="btn btn-primary" onclick="openOrderModal()">Pedir por WhatsApp</button>
    <button class="btn btn-close" onclick="toggleCart()">Cerrar Carrito</button>
</div>

<!-- MODAL DE PEDIDO -->
<div id="orderModal" class="order-modal">
    <div class="order-modal-content">
        <h3>Detalles del Pedido</h3>
        <label for="name">Nombre:</label>
        <input type="text" id="name" placeholder="Tu nombre" required><br><br>
        
        <label for="address">Direcci√≥n:</label>
        <input type="text" id="address" placeholder="Tu direcci√≥n" required><br><br>
        
        <label for="payment">M√©todo de pago:</label>
        <select id="payment">
            <option value="Efectivo">Efectivo</option>
            <option value="Transferencia">Transferencia</option>
        </select><br><br>
        <label>El coste de la mensajeria se le dar√° una vez que haya contactado con nosotros</label><br><br>
        
        <button class="btn btn-primary" onclick="submitOrder()">Enviar Pedido</button>
        <button class="btn btn-close" onclick="closeOrderModal()">Cancelar</button>
    </div>
</div>

<script>
// Productos iniciales
let products = [
    {id:1,name:"Forros",type:"forros",desc:"Selecciona un modelo",img:"https://picsum.photos/300?3", images: ["https://picsum.photos/300?3", "https://picsum.photos/300?4"]},
    {id:2,name:"Producto A",price:20,desc:"Descripci√≥n del Producto A",img:"https://picsum.photos/300?1", images: ["https://picsum.photos/300?1", "https://picsum.photos/300?2", "https://picsum.photos/300?3"]},
    {id:3,name:"Producto B",price:35,desc:"Descripci√≥n del Producto B",img:"https://picsum.photos/300?2", images: ["https://picsum.photos/300?2", "https://picsum.photos/300?4", "https://picsum.photos/300?5"]},
    {id:4,name:"Producto B",price:35,desc:"Descripci√≥n del Producto B",img:"https://picsum.photos/300?2", images: ["https://picsum.photos/300?2", "https://picsum.photos/300?4", "https://picsum.photos/300?5"]},
    
];

let modelosForros = [
    {id:101,name:"iPhone",img:"images/17ProMax.jpg"},
    {id:102,name:"Modelo 2",img:"https://picsum.photos/300?5"}
];

let forrosDisponibles = {
    101:[
        {id:201,name:"Forro Rojo",price:25,img:"https://picsum.photos/300?6", desc:"Forro rojo de alta calidad", images: ["https://picsum.photos/300?6", "https://picsum.photos/300?7"]},
        {id:202,name:"Forro Azul",price:30,img:"https://picsum.photos/300?7", desc:"Forro azul con dise√±o √∫nico", images: ["https://picsum.photos/300?7", "https://picsum.photos/300?8"]}
    ],
    102:[
        {id:203,name:"Forro Negro",price:28,img:"https://picsum.photos/300?8", desc:"Forro negro cl√°sico", images: ["https://picsum.photos/300?8", "https://picsum.photos/300?9"]}
    ]
};

let cart=[];
let selectedProduct=null;

// Funci√≥n para generar un c√≥digo de 6 d√≠gitos aleatorios
function generateOrderCode() {
    return Math.floor(1000 + Math.random() * 9000); // Genera un n√∫mero aleatorio de 4 d√≠gitos
}

// RENDER PRINCIPAL
function renderProducts(list=products){
    const container=document.getElementById("product-list");
    container.innerHTML="";
    list.forEach(p=>{
        container.innerHTML+=`<div class="product" onclick="handleClick(${p.id})">
            <img src="${p.img}">
            <h3>${p.name}</h3>
            ${p.price?`<p>$${p.price}</p>`:""}
        </div>`;
    });
}

// BUSCADOR
function searchProducts(){
    const value=document.getElementById("searchInput").value.toLowerCase();
    const filtered=products.filter(p=>p.name.toLowerCase().includes(value));
    renderProducts(filtered);
}

// CLICK PRODUCTO
function handleClick(id){
    const product=products.find(p=>p.id===id);
    if(product.type==="forros"){
        renderModelos();
    } else {
        openModal(id);
    }
}

// MODAL
function openModal(id){
    selectedProduct=products.find(p=>p.id===id);
    document.getElementById("modalTitle").innerText=selectedProduct.name;
    document.getElementById("modalImg").src=selectedProduct.img;
    document.getElementById("modalDesc").innerText=selectedProduct.desc;
    document.getElementById("modalPrice").innerText=selectedProduct.price;

    // Renderizar miniaturas
    const thumbnailsContainer = document.getElementById("modalThumbnails");
    thumbnailsContainer.innerHTML = "";
    selectedProduct.images.forEach(image => {
        thumbnailsContainer.innerHTML += `<img src="${image}" onclick="changeImage('${image}')">`;
    });

    document.getElementById("productModal").style.display="flex";
}

function closeModal(){
    document.getElementById("productModal").style.display="none";
}

function changeImage(imageSrc) {
    document.getElementById("modalImg").src = imageSrc;
}

function addToCartFromModal(){
    cart.push(selectedProduct);
    updateCart();
    closeModal();
}

// CARRITO
function toggleCart(){
    document.getElementById("cart-panel").classList.toggle("active");
}

function updateCart(){
    let total=0;
    const container=document.getElementById("cart-items");
    container.innerHTML="";
    cart.forEach((p,index)=>{
        total+=p.price;
        container.innerHTML+=`<div class="cart-item">${p.name} - $${p.price} <button onclick="removeItem(${index})">‚ùå</button></div>`;
    });
    document.getElementById("total").innerText=total;
    document.getElementById("cart-count").innerText=cart.length;
}

function removeItem(index){
    cart.splice(index,1);
    updateCart();
}

// Funci√≥n para abrir el modal de pedido
function openOrderModal() {
    document.getElementById("orderModal").style.display = "flex";
}

// Funci√≥n para cerrar el modal de pedido
function closeOrderModal() {
    document.getElementById("orderModal").style.display = "none";
}

// Enviar pedido por WhatsApp
function submitOrder() {
    const name = document.getElementById("name").value;
    const address = document.getElementById("address").value;
    const paymentMethod = document.getElementById("payment").value;
    const orderCode = generateOrderCode();
    
    const message = cart.map(p => `${p.name} - $${p.price}`).join("\n");
    const total = cart.reduce((acc, p) => acc + p.price, 0);
    const whatsappMessage = `Pedido #${orderCode}\n\nNombre: ${name}\nDirecci√≥n: ${address}\nM√©todo de pago: ${paymentMethod}\n\nProductos:\n${message}\n\nTotal: $${total}`;
    
    const phoneNumber = "5355821301"; // Reemplaza con el n√∫mero de WhatsApp
    const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(whatsappMessage)}`;
    window.open(url, "_blank");
    
    closeOrderModal(); // Cierra el modal de pedido
}

// SISTEMA FORROS
function renderModelos(){
    const container=document.getElementById("product-list");
    container.innerHTML=`<button class="back-btn" onclick="renderProducts()">‚¨Ö Volver</button>`;
    modelosForros.forEach(m=>{
        container.innerHTML+=`<div class="product" onclick="renderForros(${m.id})">
            <img src="${m.img}">
            <h3>${m.name}</h3>
        </div>`;
    });
}

function renderForros(modeloId){
    const container=document.getElementById("product-list");
    container.innerHTML=`<button class="back-btn" onclick="renderModelos()">‚¨Ö Volver</button>`;
    
    forrosDisponibles[modeloId].forEach(f=>{
        container.innerHTML+=`<div class="product" onclick="openForroModal(${f.id})">
            <img src="${f.img}">
            <h3>${f.name}</h3>
            <p>$${f.price}</p>
        </div>`;
    });
}

// ABRIR MODAL DE FORRO
function openForroModal(forroId){
    const forro = Object.values(forrosDisponibles).flat().find(f => f.id === forroId);
    selectedProduct = forro; // Usamos selectedProduct para reutilizar el modal
    document.getElementById("modalTitle").innerText = forro.name;
    document.getElementById("modalImg").src = forro.img;
    document.getElementById("modalDesc").innerText = forro.desc;
    document.getElementById("modalPrice").innerText = forro.price;

    // Renderizar miniaturas de forros
    const thumbnailsContainer = document.getElementById("modalThumbnails");
    thumbnailsContainer.innerHTML = "";
    forro.images.forEach(image => {
        thumbnailsContainer.innerHTML += `<img src="${image}" onclick="changeImage('${image}')">`;
    });

    document.getElementById("productModal").style.display = "flex";
}

renderProducts();
</script>
</body>
</html>
